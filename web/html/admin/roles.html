{{ define "roles_content" }}

<div class="d-flex justify-content-between align-items-center">
    <h1 class="h2 mb-3">{{ .Title }}</h1>
</div>
<!-- Модальное окно для добавления роли -->
<div class="modal fade" id="addRoleModal" tabindex="-1" aria-labelledby="addRoleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addRoleModalLabel">Добавить новую роль</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                    <div class="mb-3">
                        <label for="newRoleId" class="form-label">ID роли</label>
                        <input type="number"
                               class="form-control"
                               id="newRoleId"
                               name="roleId"
                               required
                               min="1">
                        <div class="form-text">Уникальный числовой идентификатор роли</div>
                    </div>

                    <div class="mb-3">
                        <label for="newRoleName" class="form-label">Наименование роли</label>
                        <input type="text"
                               class="form-control"
                               id="newRoleName"
                               name="name"
                               required
                               placeholder="Например: Администратор">
                    </div>

                    <div class="mb-3">
                        <label for="newRoleDescription" class="form-label">Описание роли</label>
                        <textarea class="form-control"
                                  id="newRoleDescription"
                                  name="description"
                                  rows="3"
                                  required
                                  placeholder="Подробное описание роли и ее прав"></textarea>
                    </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Отмена</button>
                <button type="button" class="btn btn-primary add-role-btn" id="saveNewRoleBtn">Добавить роль</button>
            </div>
        </div>
    </div>
</div>

<!-- Кнопка для открытия модального окна -->
<button type="button" class="btn btn-success mb-3" data-bs-toggle="modal" data-bs-target="#addRoleModal">
    <i class="bi bi-plus-circle"></i> Добавить роль
</button>

<div class="card shadow-sm">
    <div class="card-body p-0">
        <div class="table-responsive" style="min-width: 900px;">

            <!-- Добавляем контейнер для скролла -->
            <div style="height: calc(100vh - 400px); overflow-y: auto;">
                <table class="table table-hover mb-0" style="min-width: 900px;" id="rolesTable">
                    <colgroup>
                        <col style="width: 50px;">  <!-- ТН -->
                        <col style="width: 80px;"> <!-- Наименование -->
                        <col style="width: 420px;"> <!-- Описание -->
                        <col style="width: 140px;"> <!-- Дата создания -->
                        <col style="width: 110px;"> <!-- ТН владельца -->
                        <col style="width: 70px;"> <!-- Дата изменения -->
                        <col style="width: 50px;">  <!--ТН владельца -->
                        <col style="width: 40px;"> <!-- Операции -->
                    </colgroup>
                    {{ if .Roles }}
                    <thead>
                    <tr>
                        <th class="text-nowrap">ИД</th>
                        <th class="text-nowrap">Наименование</th>
                        <th class="text-nowrap">Описание</th>
                        <th class="text-nowrap">Дата создания</th>
                        <th class="text-nowrap">ТН владельца</th>
                        <th class="text-nowrap">Дата изменения</th>
                        <th class="text-nowrap">ТН владельца</th>
                        <th class="text-nowrap">Операции</th>
                    </tr>
                    </thead>
                    <tbody>

                    {{ range .Roles }}
                    <tr id="role-{{ .Id }}" data-id="{{ .Id }}">
                        <!-- ИД (всегда в режиме просмотра) -->
                        <td class="fw-semibold">{{ .Id }}</td>

                        <!-- Наименование - режим просмотра -->
                        <td class="view-mode forms-name">{{ .Name }}</td>

                        <!-- Описание - режим просмотра -->
                        <td class="view-mode forms-desc">{{ .Desc }}</td>

                        <!-- Наименование - режим редактирования (скрыт) -->
                        <td class="edit-mode" style="display: none;">
                            <label style="width: 75%">
                                <input type="text"
                                       name="name"
                                       value="{{ .Name }}"
                                       class="form-control form-control-sm"
                                       data-original="{{ .Name }}"
                                       required>
                            </label>
                        </td>

                        <!-- Описание - режим редактирования (скрыт) -->
                        <td class="edit-mode" style="display: none;">
                            <label style="width: 95%">
                                <input type="text"
                                       name="description"
                                       value="{{ .Desc }}"
                                       class="form-control form-control-sm "
                                       data-original="{{ .Desc }}"
                                       required>
                            </label>
                        </td>

                        <!-- Дата создания (всегда в режиме просмотра) -->
                        <td>{{ formatDateTime .AuditRec.CreatedAt }}</td>

                        <!-- ТН создателя (всегда в режиме просмотра) -->
                        <td>{{ .AuditRec.CreatedBy }}</td>

                        <!-- Дата изменения -->
                        <td class="update-at">{{ formatDateTime .AuditRec.UpdatedAt }}</td>

                        <!-- ТН редактора -->
                        <td class="update-by">{{ .AuditRec.UpdatedBy }}</td>

                        <!-- Кнопки операций -->
                        <td>
                            <div class="d-flex justify-content-center gap-2">
                                <!-- Кнопка редактирования (отображается в view-mode) -->
                                <button class="btn btn-sm btn-outline-primary edit-btn"
                                        title="Редактировать">
                                    <span>✏️</span>
                                </button>

                                <!-- Кнопки сохранения/отмены (скрыты в view-mode) -->
                                <div class="edit-buttons" style="display: none;">
                                    <button class="btn btn-sm btn-success save-role-btn" title="Сохранить">
                                        <span>✓</span>
                                    </button>
                                    <button class="btn btn-sm btn-secondary cancel-btn" title="Отмена">
                                        <span>✗</span>
                                    </button>
                                </div>
                            </div>
                        </td>
                    </tr>
                    {{ end }}
                    </tbody>
                </table>
            </div>
        </div>

        <p style="margin-top: 20px; color: #666;">
            Всего ролей: {{ len .Roles }}
        </p>
        {{ else }}
        <p style="text-align: center; color: #666; font-style: italic;">
            Нет данных о ролях
        </p>
        {{ end }}

    </div>
</div>

{{ end }}